<!DOCTYPE html>
<script src="/jsx.transformer.js"></script>
<script src="/react.js"></script>
<script src="/rx.all.js"></script>
<script>
var keydowns = Rx.Observable.fromEvent(document, 'keydown')
var keyups   = Rx.Observable.fromEvent(document, 'keyup')


var chords = Rx.Observable.merge(
  keydowns.map(function(e) {
    return {t: 'keydown', e: e}
  }),
  keyups.map(function(e) {
    return {t: 'keyup', e: e}
  })
).scan([], function(keys, e) {
  var keyCode = e.e.keyCode
  var i
  if (e.t == 'keydown' && keys.indexOf(keyCode) == -1) {
    keys = keys.concat([keyCode])
  } else if (e.t == 'keyup' && (i = keys.indexOf(keyCode)) != -1) {
    keys = keys.slice(0, i).concat(keys.slice(i+1))
  }
  if (keys.length > 2) {
    keys = keys.slice(1)
  }
  return keys
}).distinctUntilChanged()

chords.subscribe(function(e) {
  console.log(e)
})
</script>
